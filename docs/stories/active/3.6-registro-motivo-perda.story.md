# US-06: Registro Obrigatório de Motivo ao Marcar Lead como Perdido

**Story ID:** 3.6
**Epic:** EPIC-3 (Motivo de Perda)
**Status:** Draft
**Prioridade:** Média
**Esforço:** 2 pontos
**Sprint:** 2
**Data Criação:** 2026-02-23

---

## User Story

**Como** qualquer usuário do CRM
**Quero** registrar um motivo estruturado toda vez que mover um lead para a etapa 'Perdido'
**Para que** a empresa acumule dados reais sobre as principais causas de perda e possa agir sobre elas

---

## Acceptance Criteria

- [ ] Ao mover lead para coluna 'Perdido', modal abre solicitando seleção de motivo
- [ ] Lista de motivos pré-definidos: Preço, Concorrente, Sem urgência, Sem resposta, Perfil não adequado, Outro
- [ ] Opção 'Outro' exige campo de texto livre (mínimo 10 caracteres)
- [ ] Não é possível fechar o modal sem selecionar um motivo — o campo é obrigatório
- [ ] Motivo registrado fica visível no histórico do lead e no relatório de perdas

---

## Scope

### IN
- Detectar movimento de lead para coluna 'Perdido'
- Modal com lista de motivos pré-definidos
- Campo de texto livre para 'Outro'
- Validação obrigatória
- Persistência no banco de dados
- Visibilidade no histórico

### OUT
- Automação de notificação ao gestor
- Análise automática de motivos
- Sugestões de ações baseado em motivo

---

## Criteria of Done

- [ ] Modal implementado e funcional
- [ ] Validação obrigatória funcionando
- [ ] Motivo persistido corretamente
- [ ] Histórico exibe motivo
- [ ] Testes unitários cobrindo fluxo
- [ ] Deploy agendado

---

## Technical Notes

- Schema: `lead.lossReason: { type: enum('PRICE', 'COMPETITOR', 'NO_URGENCY', 'NO_RESPONSE', 'WRONG_PROFILE', 'OTHER'), otherDetails?: string }`
- Evento: `leadMovedToLost` dispara modal
- Modal bloqueia ações até seleção
- Validação: `otherDetails.length >= 10` quando `type === 'OTHER'`

---

## Change Log

- **2026-02-23** - Story criada por Orion
